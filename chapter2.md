# 【基础篇】(二)JWE算法基础
***
从前文([【基础篇】（一）JWE基础认识](chapter1.md))中，我们知道JWE只是一个协议，整个过程中的算法都是开发者具体设计的，本文会对简单梳理下JWE中的算法设计思想。

本文会对这两个问题进行解答：

> 1_**.JWE与加密算法RSA、AES等的有什么关系和差异。**_
>
> 2_**.JWE中的密钥怎么选择与使用。**_

## 1.信息安全算法扫盲

### 1.1 加密相关算法

现代密码学中，把算法的加密技术主要分为：

> 单密钥模式
>
> 双密钥模式
>
> 无密钥模式

单密钥模式，也称为对称密钥模式，加密和解密方采用同一个密钥。采用这种模式的算法就叫做对称加密算法。

双密钥模式，也称作非对称密钥模式，加密和解密方采用不同的密钥。采用这种模式的算法就叫做非对称加密算法。

无密钥模式，也称作随机密钥模式，每次的密钥都是随机生成，使用一次之后失效。这是一种理想的加密模式，由于设计难度大，目前未得到广泛应用。

本文中主要针对前两类加密算法进行简单介绍。

#### 1.1.1 对称加密算法（Symmetric Encryption）

对称加密算法，又称私钥加密算法，顾名思义加密和解密过程中只用到一个密钥，该密钥也称作私钥。

常见的对称加密算法有：DES、IDEA\(基于DES\)、3DES\(基于DES\)、RC4、RC5、RC6、AES。

#### 特点

> Feature 1. 速度较快，可适用于大数据加密；
>
> Feature 2. 算法公开，密钥安全决定该算法安全；应用过程中要严格管理密钥。

#### 部分算法对比

| 算法名 | 密钥长度 | 运算速度 | 解密时间\(假设机器每秒尝试255个 \) | 资源消耗 |
| :--- | :--- | :--- | :--- | :--- |
| AES | 128、192、256 | 快 | 1490000亿年 | 低 |
| 3DES | 112、168 | 慢 | 45亿年 | 高 |
| DES | 56 | 较快 | 无参考 | 中 |

此数据转自:[http://blog.csdn.net/leolewin/article/details/48653351](http://blog.csdn.net/leolewin/article/details/48653351%29 和 [http://blog.csdn.net/dragon_ton/article/details/46651489]%28http://blog.csdn.net/dragon_ton/article/details/46651489)

#### 1.1.2 非对称加密算法（Asymmetric Encryption）

非对称加密算法，又称公私钥加密算法，顾名思义加密和解密过程使用不同的密钥。公钥即为公开的密钥，一般用作加密；私钥即为私有的密钥，一般用作解密。

常见的非对称加密算法有：RSA、ECC、DSA。

#### 特点

> Feature 1. 速度慢，用于较小数据的加密；
>
> Feature 2. 安全系数高

#### 部分算法对比

| 算法名 | 成熟度 | 安全性 | 运算速度 | 资源消耗 |
| :--- | :--- | :--- | :--- | :--- |
| RSA | 高 | 高 | 慢 | 高 |
| DSA | 高 | 高 | 慢 | 只用于签名 |
| ECC | 低 | 高 | 快 | 低 |

数据参考：[http://blog.csdn.net/dragon\_ton/article/details/46651489](#)

#### 1.1.3 对称加密和非对称加密算法的对比

| 算法种类 | 代表 | 优点 | 缺点 |
| :--- | :--- | :--- | :--- |
| 对称加密算法 | AES | 运行速度快 |  |
| 非对称加密算 | RSA | 安全系数高 | 运行速度慢、系统开销大 |

### 1.2 信息校验相关算法

信息校验相关算法主要分为3类：数字摘要、数字认证、数字签名。

#### 1.2.1 信息摘要（MD-Message Digest）

信息摘要又称数字摘要，采用单向Hash函数将需要加密的明文“摘要”成一串固定长度（128位）的密文这一串密文又称为数字指纹，它有固定的长度，而且不同的明文摘要成密文，其结果总是不同的，而同样的明文其摘要必定一致。

Hash算法又称散列函数，是一种单向的，从明文到密文的映射过程。

常见算法的Hash算法有：MD2、MD4、MD5、HAVAL、SHA-1、SHA256等。

#### 特点

> Feature 1. 过程不可逆。
>
> Feature 2. 输出数据长度固定。
>
> Feature 3. 保证数据的完整性。

#### 部分算法对比

| 算法名 | 输出数据长度\(bit\) | 运算速度 | 安全性 |
| :--- | :--- | :--- | :--- |
| MD2 | 128 | 快 | 低 |
| MD4 | 128 | 快 | 低 |
| MD5 | 128 | 快 | 较高 |
| SHA1 | 160 | 较快 | 高 |
| SHA256 | 256 | 较快 | 高 |
| SHA384 | 384 | 较快 | 高 |
| SHA512 | 512 | 较快 | 高 |

数据参考：

#### 1.2.2 消息认证\(MA-Message Authentication\)

消息认证是指通过对消息或者消息有关的信息进行加密或签名变换进行的认证，目的是为了防止传输和存储的消息被有意无意的篡改，包括消息内容认证（即消息完整性认证）、消息的源和宿认证（即身份认证0\)、及消息的序号和操作时间认证等。

消息认证通常在摘要算法基础上再做一个对称或非对称加密算法，用于防止信息被窃取，用于证明原文的完整性和准确性，也就是说，消息认证主要用于防止信息被篡改。

常用的消息认证算法是含有密钥散列函数算法，兼容了MD和SHA算法的特性，并在此基础上加上了密钥，通常也成为HMAC算法。

HMAC的详细介绍：[http://www.ietf.org/rfc/rfc2104.txt](http://www.ietf.org/rfc/rfc2104.txt)

常见的算法有：HMAC-MD2、HMAC-MD4、HMAC-MD5、HMAC-SHA1、HMAC-SHA256、HMAC-SHA384、HMAC-SHA512。

#### 特点

> Feature 1. 保证数据完整性、准确性
>
> Feature 2. 过程不可逆
>
> Feature 3. 输出数据长度固定

#### 部分算法对比

| 算法名 | 输出数据长度\(单位:bit\) | 运算速度 |
| :--- | :--- | :--- |
| HMAC-MD2 | 128 | 慢 |
| HMAC-MD4 | 128 | 慢 |
| HMAC-MD5 | 128 | 快 |
| HMAC-SHA1 | 160 | 快 |
| HMAC-SHA256 | 256 | 快 |
| HMAC-SHA384 | 384 | 快 |
| HMAC-SHA512 | 512 | 快 |

以下为具体测试数据

```
算法名：HMAC-MD2          循环次数：10000        总耗时：7943ms
算法名：HMAC-MD4          循环次数：10000        总耗时：4686ms
算法名：HMAC-SHA51        循环次数：10000        总耗时：96ms
算法名：HMAC-SHA256       循环次数：10000        总耗时：91ms
算法名：HMAC-MD5          循环次数：10000        总耗时：65ms
算法名：HMAC-SHA384       循环次数：10000        总耗时：100ms
算法名：HMAC-SHA1         循环次数：10000        总耗时：70ms
算法名：HMAC-MD2          循环次数：100000       总耗时：62078ms
算法名：HMAC-MD4          循环次数：100000       总耗时：51112ms
算法名：HMAC-SHA512       循环次数：100000       总耗时：892ms
算法名：HMAC-SHA256       循环次数：100000       总耗时：918ms
算法名：HMAC-MD5          循环次数：100000       总耗时：441ms
算法名：HMAC-SHA384       循环次数：100000       总耗时：919ms
算法名：HMAC-SHA1         循环次数：100000       总耗时：768ms
```

测试代码详见：[https://github.com/vvvvken/SecurityAlgorithmCompare](https://github.com/vvvvken/SecurityAlgorithmCompare)

#### 1.2.3 数字签名（DS-Digital Signature）

数字签名技术是将摘要信息用发送者的私钥加密，与原文一起传送给接收者。接收者只有用发送者的公钥才能解密被加密的摘要信息，然后用HASH函数对收到的原文产生一个摘要信息，与解密的摘要信息对比。如果相同，则说明收到的信息是完整的，在传输过程中没有被修改，否则说明信息被修改过，因此数字签名能够验证信息的完整性。

数字签名保证信息传输的完整性、发送者的身份认证、防止交易中的抵赖发生。

常用的数字签名算法都是信息摘要的基础上用一个非对称加密算法进行加密处理。

常用的数字签名算法有：RSA、DSA、ECDSA。

#### 特点

> 1.保证数据的完整性、正确性、不可抵赖性。  
> 2.过程不可逆。

#### 部分算法对比

| 算法 | 速度 | 安全性 | 密钥交换 | 用途 |
| :--- | :--- | :--- | :--- | :--- |
| RSA | 慢 | 高 | 支持 | 加密、解密、签名 |
| DSA | 较快 | 较高 | 不支持 | 仅用于签名 |

### 1.3 总结

信息安全相关的算法简单总结如下表：

| 算法类型 | 特点 | 算法举例 |
| :--- | :--- | :--- |
| 对称加密 - Symmetric Encryption | 速度快、可用于处理大数据、文件 | DES、3DES、AES |
| 非对称加密 - Asymmetric Encryption | 速度慢、用户小数据 | RSA、ECC |
| 消息摘要\(MD\) - Message Digest | 完整性 | MD2、MD4、MD5、SHA1、SHA256 |
| 消息认证\(MA\) - Message Authentication | 完整性、真实性 | HMAC-MD5、HMAC-SHA1、HMAC-SHA256、HMAC-SHA384 |
| 数字签名\(DS\) - Digital Signature | 完整性、真实性、不可抵赖性 | RSA、DSA、ECDSA |

## 2.JWE算法选择

### 2.1 算法选择的参考原则

_**原则一，没有绝对的算法组合，根据自身的要求定制合理的算法组合。**_

_**原则二，性能和安全性需要同时具备**_

### 2.2 实际选择

我们知道，JWE中需要进行加密处理的有三部分数据：

> 原始报文的加密
>
> 密钥的加密
>
> 消息认证码的生成

可以根据这些数据的大小，具体选择合适的算法。

| 数据 | 特点 | 适用算法 |
| :--- | :--- | :--- |
| 原始报文加密 | 数据长度不定，通常情况长度比较大 | AES |
| 密钥的加密 | 安全性要求高，数据长度通常较短 | RSA |
| 消息认证码 | 要求完整性和真实性 | HMAC-MD5、HMAC-SHA256 |

## 3.问题讨论

_**1.JWE与加密算法RSA、AES等的有什么关系和差异？**_

> a. JWE是一套加密协议，不是具体的加密算法。
>
> b. RSA和AES 都是一种具体的加密算法，可以作为JWE某个环节的算法实现。RSA和AES可以同时存在一个JWE过程中

**2**_**.JWE中的密钥怎么选择与使用？**_

> a.JWE存在3个加密过程，这3个过程中都可能存在密钥，需要使用者明确密钥的使用。
>
> b.通常情况下，报文加密的密钥和信息认证码使用的密钥为同一个密钥，并且这部分密钥每次都不同。
>
> c.JWE中，最应该关注加密密钥的算法，如果这个过程中设计到密钥，需要做好这个密钥的管理。通常情况下采用RSA，解密方管理私钥，加密方管理公钥。

## 完结

本节中涉及到了多种信息安全的算法，这里很多内容简单带过，需要大家下来去查看详细资料。

后续会更新JWE实践过程中的具体工作 。

